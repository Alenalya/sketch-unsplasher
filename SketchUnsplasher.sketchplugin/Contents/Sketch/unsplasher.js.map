{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/unsplasher.js","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/ui\""],"names":["UI","require","DOM","SymbolMaster","onUnsplash","context","document","getSelectedDocument","selection","selectedLayers","layers","imageLayers","filter","layer","type","length","message","foreignSymbolMasters","getForeignSymbolMasters","forEach","size","width","frame","height","imageURL","randomUnsplashURL","response","requestWithURL","nsimage","NSImage","alloc","initWithData","imageData","MSImageData","initWithImage","fill","sketchObject","style","fills","firstObject","setFillType","setImage","setPatternFillType","e","log","imageOverrides","overrides","override","property","largestOverride","largestSize","largestArea","affectedLayer","IDs","path","split","i","layerInPath","getLayerWithID","undefined","getForeignLayerWithID","scale","getInstanceScale","x","y","area","overridePoint","setValue_forOverridePoint_","foreignSymbolList","documentData","foreignSymbols","symbolMasters","push","fromNative","foreignSymbol","localObject","layerID","masters","match","master","find","objectID","instance","symbolMaster","xScale","yScale","Math","round","url","request","NSURLRequest","NSURL","URLWithString","NSURLConnection","sendSynchronousRequest_returningResponse_error"],"mappings":"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","file":"unsplasher.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/unsplasher.js\");\n","const UI = require('sketch/ui'),\n      DOM = require('sketch/dom'),\n      SymbolMaster = DOM.SymbolMaster;\n\nexport function onUnsplash(context) {\n\n  var document = DOM.getSelectedDocument(),\n      selection = document.selectedLayers,\n      selectedLayers = document.selectedLayers.layers;\n\n  let imageLayers = selectedLayers.filter(layer => layer.type === 'Shape' || layer.type === 'SymbolInstance');\n\n  if (imageLayers.length === 0) {\n    UI.message('Select some shapes or symbols');\n  } else {\n\n    let foreignSymbolMasters = getForeignSymbolMasters(document);\n\n    imageLayers.forEach(layer => {\n\n      if (layer.type === 'Shape') {\n\n        let size = {\n          width: layer.frame.width,\n          height: layer.frame.height\n        };\n\n        let imageURL = randomUnsplashURL(size);\n\n        try {\n          let response = requestWithURL(imageURL);\n          if (response) {\n            let nsimage = NSImage.alloc().initWithData(response);\n            let imageData = MSImageData.alloc().initWithImage(nsimage);\n            let fill = layer.sketchObject.style().fills().firstObject();\n            fill.setFillType(4);\n            fill.setImage(imageData);\n            fill.setPatternFillType(1);\n          } else {\n            throw '⚠️ Unsplash says no. Check your internet...';\n          }\n        } catch (e) {\n          log(e);\n          UI.message(e);\n          return;\n        }\n\n      } else {\n\n        let imageOverrides = layer.overrides.filter(override => override.property === 'image');\n        let largestOverride, largestSize, largestArea = 0;\n\n        imageOverrides.forEach((override) => {\n\n          let affectedLayer = override.sketchObject.affectedLayer();\n          let size = {\n            width: affectedLayer.frame().width(),\n            height: affectedLayer.frame().height()\n          };\n\n          // Calculate scale factor for nested overrides\n          let IDs = override.path.split('/');\n\n          for (let i = 0; i < IDs.length - 1; i++) {\n            let sketchObject;\n\n            let layerInPath = document.getLayerWithID(IDs[i]);\n            if (layerInPath === undefined) {\n              sketchObject = getForeignLayerWithID(IDs[i], foreignSymbolMasters);\n            } else {\n              sketchObject = layerInPath.sketchObject;\n            }\n\n            let scale = getInstanceScale(sketchObject);\n            size.width = size.width * scale.x;\n            size.height = size.height * scale.y;\n          }\n\n          let area = size.width * size.height;\n          if (area > largestArea) {\n            largestArea = area;\n            largestSize = size;\n            largestOverride = override;\n          }\n\n        });\n\n        let imageURL = randomUnsplashURL(largestSize);\n\n        try {\n          let response = requestWithURL(imageURL);\n          if (response) {\n            let nsimage = NSImage.alloc().initWithData(response);\n            // layer.setOverrideValue(largestOverride, nsimage); // A bug in the API is preventing this from working\n            let imageData = MSImageData.alloc().initWithImage(nsimage);\n            let overridePoint = largestOverride.sketchObject.overridePoint();\n            layer.sketchObject.setValue_forOverridePoint_(imageData, overridePoint);\n          } else {\n            throw '⚠️ Unsplash says no. Check your internet...';\n          }\n        } catch (e) {\n          log(e);\n          UI.message(e);\n          return;\n        }\n\n      }\n    });\n  }\n}\n\nfunction getForeignSymbolMasters(document) {\n  let foreignSymbolList = document.sketchObject.documentData().foreignSymbols();\n  let symbolMasters = [];\n  foreignSymbolList.forEach(foreignSymbol => {\n    symbolMasters.push(SymbolMaster.fromNative(foreignSymbol.localObject()));\n  });\n  return symbolMasters;\n}\n\nfunction getForeignLayerWithID(layerID, masters) {\n  let match;\n  for (let master of masters) {\n    match = master.sketchObject.layers().find(layer => layer.objectID() == layerID);\n    if (match) {break;}\n  }\n  return match;\n}\n\nfunction getInstanceScale(instance) { // Expects sketchObject\n  let master = instance.symbolMaster();\n  let xScale = instance.frame().width() / master.frame().width();\n  let yScale = instance.frame().height() / master.frame().height();\n  return {x: xScale, y: yScale};\n}\n\nfunction randomUnsplashURL(size) {\n  let width = Math.round(size.width * 2);\n  let height = Math.round(size.height * 2);\n  return 'https://source.unsplash.com/random/' + width + 'x' + height;\n}\n\nfunction requestWithURL(url) {\n  let request = NSURLRequest.requestWithURL(NSURL.URLWithString(url));\n  return NSURLConnection.sendSynchronousRequest_returningResponse_error(request, null, null);\n}\n","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}