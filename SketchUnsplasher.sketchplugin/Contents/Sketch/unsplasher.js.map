{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/unsplasher.js","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/ui\""],"names":["UI","require","DOM","SymbolMaster","onUnsplash","context","document","getSelectedDocument","selection","selectedLayers","layers","imageLayers","filter","layer","type","length","message","foreignSymbolMasters","getForeignSymbolMasters","forEach","size","width","frame","height","imageURL","randomUnsplashURL","response","requestWithURL","nsimage","NSImage","alloc","initWithData","imageData","MSImageData","initWithImage","fill","sketchObject","style","fills","firstObject","setFillType","setImage","setPatternFillType","imageOverrides","overrides","override","property","largestOverride","largestSize","largestArea","affectedLayer","IDs","path","split","i","layerInPath","getLayerWithID","undefined","getForeignLayerWithID","scale","getInstanceScale","x","y","area","overridePoint","setValue_forOverridePoint_","e","foreignSymbolList","documentData","foreignSymbols","symbolMasters","push","fromNative","foreignSymbol","localObject","layerID","masters","match","master","find","objectID","instance","symbolMaster","xScale","yScale","Math","round","url","request","NSURLRequest","NSURL","URLWithString","NSURLConnection","sendSynchronousRequest_returningResponse_error"],"mappings":"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","file":"unsplasher.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/unsplasher.js\");\n","var UI = require('sketch/ui'),\n    DOM = require('sketch/dom'),\n    SymbolMaster = DOM.SymbolMaster;\n\nexport function onUnsplash(context) {\n\n  var document = DOM.getSelectedDocument(),\n      selection = document.selectedLayers,\n      selectedLayers = document.selectedLayers.layers;\n\n  let imageLayers = selectedLayers.filter(layer => layer.type === 'Shape' || layer.type === 'SymbolInstance');\n\n  if (imageLayers.length === 0) {\n    UI.message('Select one or more shapes or symbols');\n  } else {\n\n    let foreignSymbolMasters = getForeignSymbolMasters(document);\n\n    try {\n\n      imageLayers.forEach(layer => {\n\n        if (layer.type === 'Shape') {\n\n          let size = {\n            width: layer.frame.width,\n            height: layer.frame.height\n          };\n\n          let imageURL = randomUnsplashURL(size);\n          let response = requestWithURL(imageURL);\n          if (response) {\n            let nsimage = NSImage.alloc().initWithData(response);\n            let imageData = MSImageData.alloc().initWithImage(nsimage);\n            let fill = layer.sketchObject.style().fills().firstObject();\n            fill.setFillType(4);\n            fill.setImage(imageData);\n            fill.setPatternFillType(1);\n          } else {\n            throw 'Unsplash says no. Check your internet...';\n          }\n\n        } else {\n\n          let imageOverrides = layer.overrides.filter(override => override.property === 'image');\n          let largestOverride, largestSize, largestArea = 0;\n\n          imageOverrides.forEach((override) => {\n\n            let affectedLayer = override.sketchObject.affectedLayer();\n            let size = {\n              width: affectedLayer.frame().width(),\n              height: affectedLayer.frame().height()\n            };\n\n            // Calculate scale factor for nested overrides\n            let IDs = override.path.split('/');\n\n            for (let i = 0; i < IDs.length - 1; i++) {\n              let sketchObject;\n\n              let layerInPath = document.getLayerWithID(IDs[i]);\n              if (layerInPath === undefined) {\n                sketchObject = getForeignLayerWithID(IDs[i], foreignSymbolMasters);\n              } else {\n                sketchObject = layerInPath.sketchObject;\n              }\n\n              let scale = getInstanceScale(sketchObject);\n              size.width = size.width * scale.x;\n              size.height = size.height * scale.y;\n            }\n\n            let area = size.width * size.height;\n            if (area > largestArea) {\n              largestArea = area;\n              largestSize = size;\n              largestOverride = override;\n            }\n\n          });\n\n          let imageURL = randomUnsplashURL(largestSize);\n          let response = requestWithURL(imageURL);\n          if (response) {\n            let nsimage = NSImage.alloc().initWithData(response);\n            // layer.setOverrideValue(largestOverride, nsimage); // A bug in the API is preventing this from working\n            let imageData = MSImageData.alloc().initWithImage(nsimage);\n            let overridePoint = largestOverride.sketchObject.overridePoint();\n            layer.sketchObject.setValue_forOverridePoint_(imageData, overridePoint);\n          } else {\n            throw 'Unsplash says no. Check your internet...';\n          }\n\n        }\n      });\n\n    } catch (e) {\n      UI.message(e);\n    }\n\n  }\n}\n\nfunction getForeignSymbolMasters(document) {\n  let foreignSymbolList = document.sketchObject.documentData().foreignSymbols();\n  let symbolMasters = [];\n  foreignSymbolList.forEach(foreignSymbol => {\n    symbolMasters.push(SymbolMaster.fromNative(foreignSymbol.localObject()));\n  });\n  return symbolMasters;\n}\n\nfunction getForeignLayerWithID(layerID, masters) {\n  let match;\n  for (let master of masters) {\n    match = master.sketchObject.layers().find(layer => layer.objectID() == layerID);\n    if (match) {break;}\n  }\n  return match;\n}\n\nfunction getInstanceScale(instance) { // Expects sketchObject\n  let master = instance.symbolMaster();\n  xScale = instance.frame().width() / master.frame().width();\n  yScale = instance.frame().height() / master.frame().height();\n  return {x: xScale, y: yScale};\n}\n\nfunction randomUnsplashURL(size) {\n  let width = Math.round(size.width * 2);\n  let height = Math.round(size.height * 2);\n  return 'https://source.unsplash.com/random/' + width + 'x' + height;\n}\n\nfunction requestWithURL(url) {\n  let request = NSURLRequest.requestWithURL(NSURL.URLWithString(url));\n  return NSURLConnection.sendSynchronousRequest_returningResponse_error(request, null, null);\n}\n","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}