{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/unsplasher.js","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\""],"names":["UI","require","DOM","Settings","SymbolMaster","options","initOptions","defaults","scaleFactor","searchTerms","collectionID","option","value","evaluateString","settingForKey","undefined","setSettingForKey","string","String","parseInt","parseFloat","onUnsplash","context","document","getSelectedDocument","selection","selectedLayers","layers","imageLayers","filter","layer","type","length","message","foreignSymbolMasters","getForeignSymbolMasters","forEach","size","width","frame","height","imageURL","randomUnsplashURL","response","requestWithURL","nsimage","NSImage","alloc","initWithData","imageData","MSImageData","initWithImage","fill","sketchObject","style","fills","firstObject","setFillType","setImage","setPatternFillType","e","log","imageOverrides","overrides","override","property","scale","getInstanceScale","largestOverride","largestSize","largestArea","affectedLayer","x","y","IDs","path","split","i","layerInPath","getLayerWithID","getForeignLayerWithID","area","overridePoint","setValue_forOverridePoint_","onSettings","items","selectedIndex","findIndex","item","getSelectionFromUser","ok","foreignSymbolList","documentData","foreignSymbols","symbolMasters","push","fromNative","foreignSymbol","localObject","layerID","masters","match","master","find","objectID","instance","symbolMaster","xScale","yScale","Math","round","randomImageIndex","floor","random","url","request","NSURLRequest","NSURL","URLWithString","NSURLConnection","sendSynchronousRequest_returningResponse_error"],"mappings":"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","file":"unsplasher.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/unsplasher.js\");\n","const UI = require('sketch/ui'),\n      DOM = require('sketch/dom'),\n      Settings = require('sketch/settings'),\n      SymbolMaster = DOM.SymbolMaster;\n\nvar options = initOptions();\n\nfunction initOptions() {\n  const defaults = {\n    scaleFactor: 2,\n    searchTerms: 'landscape',\n    collectionID: 1111575\n  };\n  for (let option in defaults) {\n    let value = evaluateString(Settings.settingForKey(option));\n    if (value === undefined) {\n      Settings.setSettingForKey(option, defaults[option]);\n    } else {\n      defaults[option] = value;\n    }\n  }\n  return defaults\n}\n\nfunction evaluateString(string) {\n  if (string === 'true') {\n    return true;\n  } else if (string === 'false') {\n    return false;\n  } else if (string === String(parseInt(string))) {\n    return parseInt(string);\n  } else if (string === String(parseFloat(string))) {\n    return parseFloat(string);\n  } else {\n    return string;\n  }\n}\n\nexport function onUnsplash(context) {\n\n  var document = DOM.getSelectedDocument(),\n      selection = document.selectedLayers,\n      selectedLayers = document.selectedLayers.layers;\n\n  let imageLayers = selectedLayers.filter(layer => layer.type === 'Shape' || layer.type === 'SymbolInstance');\n\n  if (imageLayers.length === 0) {\n    UI.message('Select some shapes or symbols');\n  } else {\n\n    let foreignSymbolMasters = getForeignSymbolMasters(document);\n\n    imageLayers.forEach(layer => {\n\n      if (layer.type === 'Shape') {\n\n        let size = {\n          width: layer.frame.width,\n          height: layer.frame.height\n        };\n\n        let imageURL = randomUnsplashURL(size);\n\n        try {\n          let response = requestWithURL(imageURL);\n          if (response) {\n            let nsimage = NSImage.alloc().initWithData(response);\n            let imageData = MSImageData.alloc().initWithImage(nsimage);\n            let fill = layer.sketchObject.style().fills().firstObject();\n            fill.setFillType(4);\n            fill.setImage(imageData);\n            fill.setPatternFillType(1);\n          } else {\n            throw '⚠️ Unsplash says no. Check your internet...';\n          }\n        } catch (e) {\n          log(e);\n          UI.message(e);\n          return;\n        }\n\n      } else {\n\n        let imageOverrides = layer.overrides.filter(override => override.property === 'image');\n        let scale = getInstanceScale(layer.sketchObject); // Approx. scale depending on constraints\n        let largestOverride, largestSize, largestArea = 0;\n\n        imageOverrides.forEach((override) => {\n\n          let affectedLayer = override.sketchObject.affectedLayer();\n\n          let size = {\n            width: affectedLayer.frame().width() * scale.x,\n            height: affectedLayer.frame().height() * scale.y\n          };\n\n          // Calculate scale factor for nested overrides\n          let IDs = override.path.split('/');\n\n          for (let i = 0; i < IDs.length - 1; i++) {\n            let sketchObject;\n\n            let layerInPath = document.getLayerWithID(IDs[i]);\n            if (layerInPath === undefined) {\n              sketchObject = getForeignLayerWithID(IDs[i], foreignSymbolMasters);\n            } else {\n              sketchObject = layerInPath.sketchObject;\n            }\n\n            let scale = getInstanceScale(sketchObject);\n            size.width = size.width * scale.x;\n            size.height = size.height * scale.y;\n          }\n\n          let area = size.width * size.height;\n          if (area > largestArea) {\n            largestArea = area;\n            largestSize = size;\n            largestOverride = override;\n          }\n\n        });\n\n        let imageURL = randomUnsplashURL(largestSize);\n\n        try {\n          let response = requestWithURL(imageURL);\n          if (response) {\n            let nsimage = NSImage.alloc().initWithData(response);\n            // layer.setOverrideValue(largestOverride, nsimage); // A bug in the API is preventing this from working\n            let imageData = MSImageData.alloc().initWithImage(nsimage);\n            let overridePoint = largestOverride.sketchObject.overridePoint();\n            layer.sketchObject.setValue_forOverridePoint_(imageData, overridePoint);\n          } else {\n            throw '⚠️ Unsplash says no. Check your internet...';\n          }\n        } catch (e) {\n          log(e);\n          UI.message(e);\n          return;\n        }\n\n      }\n    });\n  }\n}\n\nexport function onSettings(context) {\n  let items = ['1', '2', '3', '4'];\n  let selectedIndex = items.findIndex(item => item === String(options.scaleFactor));\n\n  let selection = UI.getSelectionFromUser(\n    'Select the factor for scaling images',\n    items,\n    selectedIndex\n  );\n\n  let ok = selection[2];\n  if (ok) {\n    let value = parseInt(items[selection[1]]);\n    options.scaleFactor = value;\n    Settings.setSettingForKey('scaleFactor', value);\n  }\n}\n\nfunction getForeignSymbolMasters(document) {\n  let foreignSymbolList = document.sketchObject.documentData().foreignSymbols();\n  let symbolMasters = [];\n  foreignSymbolList.forEach(foreignSymbol => {\n    symbolMasters.push(SymbolMaster.fromNative(foreignSymbol.localObject()));\n  });\n  return symbolMasters;\n}\n\nfunction getForeignLayerWithID(layerID, masters) {\n  let match;\n  for (let master of masters) {\n    match = master.sketchObject.layers().find(layer => layer.objectID() == layerID);\n    if (match) {break;}\n  }\n  return match;\n}\n\nfunction getInstanceScale(instance) { // Expects sketchObject\n  let master = instance.symbolMaster();\n  let xScale = instance.frame().width() / master.frame().width();\n  let yScale = instance.frame().height() / master.frame().height();\n  return {x: xScale, y: yScale};\n}\n\nfunction randomUnsplashURL(size) {\n  let width = Math.round(size.width * options.scaleFactor);\n  let height = Math.round(size.height * options.scaleFactor);\n  let randomImageIndex = Math.floor(Math.random() * 1000);\n  return 'https://source.unsplash.com/random/' + width + 'x' + height + '/?sig=' + randomImageIndex;\n}\n\nfunction requestWithURL(url) {\n  let request = NSURLRequest.requestWithURL(NSURL.URLWithString(url));\n  return NSURLConnection.sendSynchronousRequest_returningResponse_error(request, null, null);\n}\n","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}